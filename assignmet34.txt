#!/bin/bash

# Gather information
USERNAME=$(whoami)
DATE=$(date)
HOSTNAME=$(hostname)
OS=$(lsb_release -d | awk -F'\t' '{print $2}' || echo "Error retrieving OS")
UPTIME=$(uptime -p | sed 's/up //' || echo "Error retrieving uptime")
CPU=$(lscpu | grep 'Model name' | awk -F': ' '{print $2}' || echo "Error retrieving CPU")
CPU_SPEED=$(lscpu | grep 'CPU MHz' | awk -F': ' '{print $2}' | xargs)MHz || CPU_SPEED="Error retrieving CPU speed"
RAM=$(free -h --si | awk '/^Mem:/ {print $2}' || echo "Error retrieving RAM")
DISK=$(lsblk -o NAME,SIZE,TYPE | grep disk | awk '{print $1 " (" $2 ")"}' | xargs | sed 's/ /, /g' || echo "Error retrieving disk information")
VIDEO=$(lspci | grep -i vga | awk -F': ' '{print $2}' || echo "Error retrieving video card information")
FQDN=$(hostname -f || echo "Error retrieving FQDN")
HOST_IP=$(hostname -I | awk '{print $1}' || echo "Error retrieving host IP")
GATEWAY_IP=$(ip route | grep default | awk '{print $3}' || echo "Error retrieving gateway IP")
DNS_SERVER=$(grep 'nameserver' /etc/resolv.conf | awk '{print $2}' || echo "Error retrieving DNS server")
NIC=$(ip link show | awk -F ': ' '/^[0-9]+: / {print $2}' | head -n 1 || echo "Error retrieving NIC")
NIC_IP=$(ip a show $NIC | grep -w inet | awk '{print $2}' || echo "Error retrieving NIC IP")
USERS_LOGGEDIN=$(who | awk '{print $1}' | sort | uniq | xargs || echo "Error retrieving logged in users")
DISK_SPACE=$(df -h --output=source,size | grep '^/dev/' | awk '{print $1, $2}' | xargs | sed 's/ /, /g' || echo "Error retrieving disk space")
PROCESS_COUNT=$(ps aux | wc -l || echo "Error retrieving process count")
LOAD_AVERAGES=$(uptime | awk -F'load average:' '{ print $2 }' | cut -d',' -f1-3 || echo "Error retrieving load averages")
MEMORY_ALLOCATION=$(free -h || echo "Error retrieving memory allocation")
LISTENING_PORTS=$(ss -tuln | awk 'NR>1 {print $5}' | cut -d':' -f2 | xargs | sed 's/ /, /g' || echo "Error retrieving listening ports")
UFW_RULES=$(ufw status | grep ALLOW | awk '{print $2}' | xargs | sed 's/ /, /g' || echo "Error retrieving UFW rules")
# Generate report
{
    echo -e "\nSystem Report generated by $USERNAME, $DATE\n"
    echo "System Information"
    echo "------------------"
    echo "Hostname: $HOSTNAME"
    echo "OS: $OS"
    echo "Uptime: $UPTIME"
    echo
    echo "Hardware Information"
    echo "--------------------"
    echo "CPU: $CPU"
    echo "Speed: $CPU_SPEED"
    echo "RAM: $RAM"
    echo "Disk(s): $DISK"
    echo "Video: $VIDEO"
    echo
    echo "Network Information"
    echo "-------------------"
    echo "FQDN: $FQDN"
    echo "Host Address: $HOST_IP"
    echo "Gateway IP: $GATEWAY_IP"
    echo "DNS Server: $DNS_SERVER"
    echo
    echo "InterfaceName: $NIC"
    echo "IP Address: $NIC_IP"
    echo
    echo "System Status"
    echo "-------------"
    echo "Users Logged In: $USERS_LOGGED_IN"
    echo "Disk Space: $DISK_SPACE"
    echo "Process Count: $PROCESS_COUNT"
    echo "Load Averages: $LOAD_AVERAGES"
    echo "Memory Allocation:"
    echo "$MEMORY_ALLOCATION"
    echo "Listening Network Ports: $LISTENING_PORTS"
    echo "UFW Rules: $UFW_RULES"
    echo -e "\n"
}
